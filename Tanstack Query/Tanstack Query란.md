# React Query란?

React의 서버 상태를 관리하는 라이브러리이다.

## 클라이언트 상태와 서버 상태의 차이점

### 클라이언트 상태

웹 브라우저 세션과 관련된 모든 정보를 의미한다.

ex) 사용자는 가장 잘 아는 언어로 텍스트를 읽기 위해 언어를 선택하거나 테마를 밝은색이나 어두운색 배경으로 변경할 수 있는데 이것은 서버에서 일어나는 일과는 아무 관련이 없다.

### 서버 상태

서버에 데이터가 저장된다.

ex) DB에 저장하는 데이터가 해당된다.

## React Query

클라이언트에서 서버 데이터 캐시를 관리한다.

React 코드에 서버 데이터가 필요할 때 패치나 Axios를 사용해 서버로 바로 이동하지 않고 React Query 캐시를 요청한다.

> \*캐시: Cache란 자주 사용하는 데이터나 값을 미리 복사해 놓는 임시 장소를 가리킨다. 캐시는 저장 공간이 작고 비용이 비싼 대신 빠른 성능을 제공한다.

### React Query의 역할

해당 캐시의 데이터를 유지 관리하는 것이다.

데이터를 관리하는 것은 React Query지만 서버의 새 데이터로 캐시를 업데이트하는 시기를 설정하는 것은 사용자의 몫이다.

### React Query 캐시 예시

blog-posts라는 key로 할당한 데이터를 식별한다.

클라이언트 캐시에 있는 데이터가 서버의 데이터와 일치하는지 확인해야한다.

1. 명령형으로 처리하는 방법
   - 쿼리 클라이언트에 데이터를 무효화하고 캐시에 교체할 새 데이터를 서버에서 가져오게 지시하는 것이다.
2. 선언형으로 처리하는 방법
   - Refetch를 트리거하는 조건을 구성하는 것이다.
     - 브라우저 창이 다시 포커스 되었을 때
     - stateTime으로 데이터를 언제 다시 트리거할지도 구성할 수 있다.

```jsx
key: 'blog-posts'
data: [
	1:{
		title: 'React Query',
		tagLine: 'What is this thing?'
	},
	2:{
		title: 'React Query Mutations',
		tagLine: 'Not just for ninja turtles'
	}
]
staleTime: 30 seconds
```

### React Query에서 서버 상태에 도움이 되는 도구

- 서버에 대한 모든 쿼리의 로딩 및 오류 상태를 유지해주기 때문에 수동으로 할 필요가 없어진다.
- 사용자를 위해 데이터의 페이지 매김(Pagination) 또는 무한 스크롤이 필요한 경우 데이터를 조각으로 가져올 수 있는 도구도 제공한다.
- 사용자가 언제 이를 필요로 할지 예상하여 Prefetch를 수행할 수 있다.
- 데이터를 미리 가져와서 캐시에 넣으면 사용자에게 데이터가 필요할 때 앱이 캐시에서 해당 데이터를 가져오기 때문에 사용자는 서버에 연결할 때까지 기다릴 필요가 없어진다.
- Mutations: 데이터의 변이나 업데이트를 관리할 수 있다.
- 쿼리는 키로 식별되기 때문에 React Query는 요청을 관리할 수 있고, 페이지를 로드하고 해당 페이지의 여러 구성 요소가 동일한 데이터를 요청하는 경우 React Query는 쿼리를 한 번에 보낼 수 있다.
- 기존 쿼리가 나가는 동안 다른 구성 요소가 데이터를 요청하는 경우 중복 요청을 제거할 수 있다.
- 서버에서 오류가 발생하는 경우에 대한 재시도를 관리할 수 있다.
- 쿼리가 성공하거나 오류가 났을 때를 구별해서 조치를 취할 수 있도록 콜백을 전달할 수 있다.
